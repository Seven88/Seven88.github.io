---
title: 正则表达式入门及 Python 常见用法
date: 2015-03-18 20:20:41
tags: [正则表达式, Python]
---

什么是正则表达式
------------

正则表达式是由字符和特殊符号组成的字符串，用来匹配符合某个句法规则的字符串。

为什么要用正则表达式
------------

对于一些简单的字符串查找，可以使用字符串匹配方法来实现。比如检测一个字符串是否以 `'abc'` 开头，用 Python 中的字符串方法 `startswith` 即可。但对于一些复杂的规则，比如检测一个字符串是否是一个 email 地址，用字符串匹配检查等方法当然也能实现，但是会很麻烦，用正则表达式就简单很多。此外，在大数据处理、网页爬取等方面，正则表达式有着广泛的应用。


正则表达式怎么写
------------

首先来介绍组成正则表达式最常用的字符和符号，如下表：

| 字符  | 说明   |  正则表达式示例  |
| ---   | ------ | ----- |
|str    | 匹配字符串的值    | hello|
|re1&#124;re2 | 匹配正则表达式 re1 或者 re2    | hello&#124;hi |
|. | 匹配任意字符（换行符除外）| b.b |
|^ | 匹配字符串的开始 | ^hello |
|$ | 匹配字符串结尾 | world$ |
|* | 匹配前面出现的正则表达式零次或者多次 | [a-z0-9]* |
|+ | 匹配前面出现的正则表达式一次或者多次 | [a-z]+\\.com |
|? | 匹配前面出现的正则表达式零次或者一次 | goo？ |
|{N} | 匹配前面出现的正则表达式 N 次 | [a-z]{3} |
|{M,N} | 匹配重复出现 M 到 N 次的正则表达式 | [0-9]{3,5} |
|[...] | 匹配字符组里出现的任意一个字符。特殊字符仅有反斜线 \ 保持特殊含义，用于转义字符。其它特殊字符如星号、加号、各种括号等均作为普通字符。 | [aoe] |
|[..x-y..] | 匹配从字符 x 到 y 中的任意一个字符 | [A-Za-z], [0-9] |
|[^..] | 不匹配此字符集中出现的任何一个字符，包括某一范围的字符 | [^aoe], [^A-Za-z]
|(...) | 匹配封闭括号中正则表达式，并保存为子组 | ([0-9]{3})?, f(oo&#124;u)bar |
|\d | 匹配任意数字，和 [0-9] 一样 （\D 为反义，匹配非数字） | str\d |
|\w | 匹配任意数字、字母字符，和 [A-Za-z0-9_] 一样 （\W 为反义） | abc\w |
|\s | 匹配任意空白符，和 [\n\r\t\v\f] 相同 （\S 为反义）| end\s |
|\b | 匹配一个单词边界，也就是指单词和空格间的位置 \B 为反义）| hi\b |
|\nn | 匹配已保存的子组 | price:\16 |
|\c | 匹配特殊字符c | \\., \\\, \\* |
|\A(\Z) | 匹配字符串的起始（结束） | \ADear, End\Z

<!-- more -->

### 用管道符 `|` 匹配多个正则表达式模式

使用管道符可以灵活的匹配不止一个字符串。

| 正则表达式 | 匹配的字符串 |
| --- | --- |
| here&#124;there | here, there |
| com&#124;cn | com, cn|
| bat&#124;bet&#124;bit | bat, bet, bit |

### 匹配任意单一字符 `.`

使用 `.` 符合，可以匹配除换行符外的任意一个字符。注意，匹配 `.` 本身，需用 `\.` 来转义。

| 正则表达式 | 匹配的字符串 |
| --- | --- |
| f.c | f 和 c 之间可以是任意字符，如fac, f8c |
| .. | 任意两个字符 |

### 从字符结尾或者单词边界开始匹配 `^ $ \b \B`

用 `^` 和 `$` 从字符串的开头或者结尾来匹配的情况：

| 正则表达式 | 匹配的字符串 |
| --- | --- |
| ^Hi | 任意以 Hi 开头的字符串 |
| bye$ | 任意以 bye 结尾的字符串 |
| ^Good luck$ | 仅匹配 `Good luck` 字符串 |

使用 `\b` 和 `\B` 匹配单词边界的示例：

| 正则表达式 | 匹配的字符串 |
| --- | --- |
| \bthe | 以 the 开头的字符串 |
| \bthe\b |  仅匹配 the |
| \Bthe | 任意保护 the 但不以 the 开头的单词，如 athe |

### 字符类 `[]`

匹配某些特定的字符，使用 `[]`。

| 正则表达式 | 匹配的字符串 |
| --- | --- |
| b[aei]t | bat, bet, bit |
|[a-z]_[0-9] | 首字符为小写字母，第二个字符是 `_`，第三个字符为数字的字符串 |

### 指定范围 `-` 和否定 `^`

在方括号中使用 `-` 表示指定字符范围。方括号中第一个字符为 `^` 表示不匹配指定字符集里的任意字符。

| 正则表达式 | 匹配的字符串 |
| --- | --- |
| x[0-9] | 第一个字符为 `x`，第二个字符为任意数字 |
| [^a-z] | 一个不为小写字母的字符 |
| ^\t\n | 除 TAB 符和换行符外的任意一个字符 |
| "-a | ASCII 码中按顺序从 `"` 到 `a` 的任意一个字符 |

### 重复匹配

| 正则表达式 | 匹配的字符串 |
| --- | --- |
| 0?[1-9] | 1~9中任意数字，前面可能还有一个 0 |
| </?[^>]+> | html 标签（没验证是否有效）|
[[0-9]{8,10} ] 8到10位数字 |

### 特殊字符

前面提到的一些特殊字符可以表示字符集和，如 `\d` 表示 `0~9`。来看几组示例：

| 正则表达式 | 匹配的字符串 |
| --- | --- |
| \w+\d+ | 一个由字母、数字或 `_` 组成的字符串，结尾是一个或多个数字 |
| \w+@\w+\\.com | 一个 .com 格式的 email 地址 |
| 137\d{8} | 137 开头的手机号码 |

### 用 `()` 建组

有时候除了匹配检查字符串是否符合某个规则，还想再匹配成功时取出特定字符，就需要使用 `()` 来实现了。

圆括号在正则表达式中使用可以实现以下功能：
- 对正则表达式进行分组
- 匹配子组

| 正则表达式 | 匹配的字符串 |
| --- | --- |
| \d+(\\.\d*)? | 表示简单的浮点型 |
| (Mr?s?\\.)?[A-z][a-z]* [ A-za-z-]+ | 英文名和姓 |

Python 中正则表达式常用方法
------

### re 模块

Python 中使用正则表达式，需要用到 `re` 模块。下面介绍该模块常见的一些方法。

### re.match(pattern, string, flags=0)

用正则表达式 `pattern` 匹配字符串 `string`，`flags` 为可选标识符。`flags` 可选值为：

| flags 值 | 说明 |
| --- | --- |
| re.I | 忽略大小写 |
| re.L | '\\w', '\\W', '\\b', '\\B', '\\s', '\\S' 的使用与当前位置有关 |
| re.M | 使 '^', '$' 分别匹配字符串和行的开始和结束，如果不指定则只匹配字符串的 |
| re.S | 使 `.` 匹配任何东西，包括一个换行；如果不指定，则不匹配换行 |
| re.U | 使 '\\w', '\\W', '\\b', '\\B', '\\d', '\\D', '\\s', '\\S' 依赖于unicode字符属性数据库 |
| re.X | 使空格（除了转义字符代表的空格），和 `#` 不作为正则表达式的一部分，这样写出的正则表达式更加优美，还可以加 `#` 注释 |

`match` 方法会从**字符串开头**开始匹配，如果匹配成功，返回一个匹配对象，失败则返回 `None`。匹配对象可以使用 `group()` 方法来显示成功的匹配。

``` Python
>>> m = re.match('a[a-z]', 'abcd')
>>> if m is not None:
...     m.group()
'ab'
```

### re.search(pattern, string, flags=0)

`search` 方法的参数和 `match` 相同，区别在于 `search` 会匹配字符串中任意位置。如果匹配成功，返回一个匹配对象，失败则返回 `None`。

来看两个例子：

``` Python
>>> m = re.search('f[oae]+', 'somefoo')
>>> if m is not None:
...     m.group()
'foo'
```

``` Python
>>> m = re.match('f[oae]+', 'somefoo')
>>> if m is not None:   # 此时 m 为 None
...     m.group()
```

### 子组的使用

``` Python
>>> m = re.match('(\w\w\w)-(\d\d\d)', 'abc-123')  # 用 () 进行了分组
>>> if m is not None:
...     m.group()   # 所有匹配的部分
'abc-123'
>>> m.group(1)  # 匹配的子组1
'abc'
>>> m.group(2)  # 匹配的子组2
'123'
>>> m.groups()  # 匹配的所有子组
('abc', '123')
```

当有匹配分组时，可以使用 `groups` 方法获取一个包含所有匹配子组的元组。

子组还可以嵌套使用：

``` Python
>>> m = re.match('(a(b))', 'ab')
>>> m.group()
'ab'
>>> m.group(1)
'ab'
>>> m.group(2)
'b'
>>> m.groups()
('ab', 'b')
```

### re.findall(pattern, string, flags=0)

参数同 `search`。`findall` 返回所有匹配成功的列表，如无匹配，返回空列表。

``` Python
>>> re.findall('er', 'there is peter')
['er', 'er']
```

### re.sub(pattern, repl, string, count=0, flags=0)

用正则表达式 `pattern` 匹配字符串 `string`，匹配成功后用 `repl` 进行替换。`count` 为最大替换次数，0 表示全部替换。`flags` 为可选标识符。返回替换后的字符串。

``` Python
>>> re.sub('X', '10', 'X * X == X ** 2')
'10 * 10 == 10 ** 2'
```

另外还有一个 `re.subn` 方法，参数和 `sub` 相同，返回值不同，为一个元组：('替换后的字符串', 替换的次数)

``` Python
>>> re.subn('X', '10', 'X * X == X ** 2')
('10 * 10 == 10 ** 2', 3)
```

### re.split(pattern, string, maxsplit=0, flags=0)

用正则表达式 `pattern` 分割 `string`，`maxsplit` 为最大分隔次数，0 表示全部分隔。`flags` 为可选标识符。

``` Python
>>> re.split('\W+', 'Words, words, words.')  # 用非数字字母分割
['Words', 'words', 'words', '']
```
